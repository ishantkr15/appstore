<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModGalaxy Admin Dashboard</title>
    <meta name="robots" content="noindex, nofollow">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Professional Admin Theme */
        :root {
            --primary: #00c853;
            --primary-dark: #00a844;
            --primary-light: #e8f5e9;
            --primary-soft: rgba(0, 200, 83, 0.1);
            --dark: #1a1f2e;
            --dark-light: #2a2f3e;
            --dark-soft: #3a3f4e;
            --bg: #f0f3f8;
            --bg-light: #f8fafd;
            --border: #e2e8f0;
            --border-dark: #cbd5e0;
            --text: #1e293b;
            --text-light: #64748b;
            --text-lighter: #94a3b8;
            --white: #ffffff;
            --success: #00c853;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gradient-dark: linear-gradient(135deg, #1a1f2e 0%, #2a2f3e 100%);
            --gradient-info: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: var(--bg);
            height: 100vh;
            display: flex;
            overflow: hidden;
            color: var(--text);
        }

        /* Login Overlay - Professional */
        .login-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #0b1120 0%, #1a1f2e 100%);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .login-box {
            background: var(--white);
            padding: 50px 40px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            text-align: center;
            width: 100%;
            max-width: 420px;
            animation: slideUp 0.5s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-box .logo {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-box .sub {
            color: var(--text-light);
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .login-box input[type=password] {
            width: 100%;
            padding: 14px 18px;
            margin-bottom: 20px;
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 1rem;
            outline: none;
            text-align: center;
            letter-spacing: 4px;
            transition: all 0.2s;
            background: var(--bg-light);
        }

        .login-box input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-soft);
        }

        .login-error {
            color: var(--danger);
            font-size: 0.85rem;
            margin-bottom: 12px;
            display: none;
            background: rgba(239, 68, 68, 0.1);
            padding: 8px;
            border-radius: var(--radius-sm);
        }

        /* Sidebar - Professional */
        .sidebar {
            width: 260px;
            background: var(--gradient-dark);
            color: #fff;
            display: flex;
            flex-direction: column;
            padding: 24px 16px;
            flex-shrink: 0;
            z-index: 50;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        }

        .brand {
            font-size: 1.6rem;
            font-weight: 800;
            margin-bottom: 40px;
            padding: 0 12px;
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand span {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-item {
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: var(--radius-md);
            cursor: pointer;
            color: #a0aec0;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: translateX(4px);
        }

        .nav-item.active {
            background: var(--primary-soft);
            color: var(--primary);
            font-weight: 600;
            border-left: 3px solid var(--primary);
        }

        .nav-sep {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 16px 0;
        }

        .menu-toggle {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 60;
            background: var(--gradient-primary);
            color: #fff;
            border: none;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 45;
        }

        /* Main Content */
        .main {
            flex: 1;
            overflow-y: auto;
            padding: 28px 32px;
            background: var(--bg);
        }

        .page-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
            background: var(--white);
            padding: 20px 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }

        .page-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text);
            background: linear-gradient(135deg, var(--text) 0%, #000 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* Stats Cards - Professional */
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat {
            padding: 24px;
            border-radius: var(--radius-lg);
            color: #fff;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat::after {
            content: '';
            position: absolute;
            right: -20px;
            top: -20px;
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .stat.s1 {
            background: linear-gradient(135deg, #00c853, #69f0ae);
        }

        .stat.s2 {
            background: linear-gradient(135deg, #3b82f6, #93c5fd);
        }

        .stat.s3 {
            background: linear-gradient(135deg, #f59e0b, #fcd34d);
        }

        .stat.s4 {
            background: linear-gradient(135deg, #8b5cf6, #c4b5fd);
        }

        .stat.s5 {
            background: linear-gradient(135deg, #ec4899, #f9a8d4);
        }

        .stat.s6 {
            background: linear-gradient(135deg, #14b8a6, #6ee7b7);
        }

        .stat.s7 {
            background: linear-gradient(135deg, #f97316, #fdba74);
        }

        .stat.s8 {
            background: linear-gradient(135deg, #6366f1, #a5b4fc);
        }

        .stat-lbl {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-bottom: 6px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .stat-val {
            font-size: 2rem;
            font-weight: 800;
            line-height: 1.2;
        }

        /* Toolbar */
        .toolbar {
            background: var(--white);
            padding: 16px 20px;
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .toolbar input,
        .toolbar select {
            padding: 10px 14px;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            outline: none;
            transition: all 0.2s;
            min-width: 0;
            background: var(--bg-light);
        }

        .toolbar input:focus,
        .toolbar select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-soft);
        }

        /* Table - Professional */
        .tbl-wrap {
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
        }

        th {
            padding: 16px 16px;
            text-align: left;
            background: #f8fafc;
            color: var(--text-light);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }

        td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
            font-size: 0.85rem;
        }

        tr:hover {
            background: #fafbfc;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .ico {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            object-fit: cover;
            background: var(--bg-light);
            border: 1px solid var(--border);
        }

        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
            display: inline-block;
        }

        .badge-c {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        .badge-id {
            background: #eff6ff;
            color: var(--info);
        }

        /* Buttons - Professional */
        .btn {
            padding: 10px 20px;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            border: 1px solid transparent;
        }

        .btn-p {
            background: var(--gradient-primary);
            color: #fff;
            box-shadow: 0 4px 10px -2px var(--primary);
        }

        .btn-p:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px -2px var(--primary);
        }

        .btn-s {
            background: var(--white);
            color: var(--text);
            border: 1.5px solid var(--border);
        }

        .btn-s:hover:not(:disabled) {
            background: var(--bg-light);
            border-color: var(--border-dark);
        }

        .btn-d {
            background: #fef2f2;
            color: var(--danger);
            border: 1.5px solid #fee2e2;
        }

        .btn-d:hover:not(:disabled) {
            background: #fee2e2;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.75rem;
            gap: 4px;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
            padding: 14px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Form Panel - Professional */
        .panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 560px;
            max-width: 100vw;
            height: 100%;
            background: var(--white);
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .panel.open {
            transform: translateX(0);
        }

        .panel-header {
            padding: 24px 28px 16px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            background: linear-gradient(to right, var(--white), #fafbfc);
        }

        .panel-header h2 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
        }

        .panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px 28px;
            -webkit-overflow-scrolling: touch;
        }

        .panel-footer {
            padding: 16px 28px;
            border-top: 2px solid var(--border);
            display: flex;
            gap: 12px;
            flex-shrink: 0;
            background: #fafbfc;
        }

        /* Form Elements */
        .fg {
            margin-bottom: 18px;
        }

        .fg label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text);
            font-size: 0.85rem;
        }

        .fg label .req {
            color: var(--danger);
        }

        .fg .hint {
            font-size: 0.7rem;
            color: var(--text-lighter);
            margin-top: 4px;
        }

        .fc {
            width: 100%;
            padding: 10px 14px;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            outline: none;
            background: var(--bg-light);
            transition: all 0.2s;
        }

        .fc:focus {
            border-color: var(--primary);
            background: var(--white);
            box-shadow: 0 0 0 3px var(--primary-soft);
        }

        .row2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        /* Icon Preview */
        .icon-preview {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-light);
            border-radius: var(--radius-lg);
            border: 2px dashed var(--border);
            margin-bottom: 20px;
        }

        .icon-preview img {
            width: 64px;
            height: 64px;
            border-radius: var(--radius-md);
            object-fit: cover;
            background: var(--white);
            border: 2px solid var(--white);
            box-shadow: var(--shadow-md);
        }

        .icon-preview .name {
            font-weight: 700;
            color: var(--text);
            font-size: 1rem;
        }

        .icon-preview .slug {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .sync-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
            vertical-align: middle;
        }

        .sync-dot.online {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }

        .sync-dot.offline {
            background: var(--danger);
        }

        /* Section Title */
        .section-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Chart bars */
        .chart-bar-wrap {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .chart-row {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.85rem;
        }

        .chart-label {
            width: 80px;
            color: var(--text-light);
            text-align: right;
            flex-shrink: 0;
            font-size: 0.8rem;
        }

        .chart-bar {
            height: 28px;
            border-radius: var(--radius-sm);
            background: linear-gradient(90deg, var(--primary), #69f0ae);
            min-width: 4px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chart-val {
            color: var(--text);
            font-weight: 600;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        /* Category card grid */
        .cat-mgr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 16px;
        }

        .cat-mgr-card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
        }

        .cat-mgr-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .cat-mgr-card .top {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cat-mgr-card .emoji {
            font-size: 2rem;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }

        .cat-mgr-card .cname {
            font-weight: 700;
            color: var(--text);
            font-size: 1rem;
        }

        .cat-mgr-card .cdesc {
            font-size: 0.8rem;
            color: var(--text-light);
            line-height: 1.5;
        }

        .cat-mgr-card .ccount {
            font-size: 0.75rem;
            color: var(--primary);
            font-weight: 600;
            background: var(--primary-light);
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-block;
            align-self: flex-start;
        }

        .cat-mgr-card .actions {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        /* Top apps list */
        .top-app-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            background: var(--white);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .top-app-row:hover {
            background: var(--bg-light);
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .top-app-row img {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            object-fit: cover;
        }

        .top-app-row .aname {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text);
            flex: 1;
        }

        .top-app-row .acount {
            font-weight: 700;
            color: var(--primary);
            font-size: 0.85rem;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            left: auto;
            background: var(--white);
            color: var(--text);
            padding: 14px 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            transform: translateY(120px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2000;
            font-weight: 500;
            font-size: 0.9rem;
            max-width: 400px;
            border-left: 4px solid var(--success);
        }

        .toast.show {
            transform: translateY(0);
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        /* Checkbox style */
        .fg input[type="checkbox"] {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        /* Color input */
        input[type="color"] {
            padding: 4px;
            height: 42px;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                height: 100%;
                width: 260px;
                transition: left 0.3s ease;
                z-index: 50;
            }

            .sidebar.open {
                left: 0;
            }

            .sidebar-overlay.show {
                display: block;
            }

            .menu-toggle {
                display: block;
            }

            .main {
                padding: 70px 16px 20px 16px;
                height: 100vh;
                overflow-y: auto;
            }

            .page-top {
                flex-direction: column;
                align-items: flex-start;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .stat {
                padding: 18px;
            }

            .stat-val {
                font-size: 1.5rem;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar input,
            .toolbar select {
                width: 100%;
            }

            .panel {
                width: 100vw;
            }

            .row2 {
                grid-template-columns: 1fr;
            }

            .toast {
                left: 16px;
                right: 16px;
                bottom: 16px;
                max-width: none;
            }

            .cat-mgr-grid {
                grid-template-columns: 1fr;
            }

            .chart-label {
                width: 70px !important;
                font-size: 0.72rem !important;
            }

            .top-app-row img {
                width: 28px !important;
                height: 28px !important;
            }

            table th,
            table td {
                padding: 10px 8px;
                font-size: 0.78rem;
            }
        }

        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }

            .login-box {
                padding: 35px 25px;
            }

            .login-box .logo {
                font-size: 1.8rem;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>

<body>
    <!-- Login -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <div class="logo"><span>MOD</span>Galaxy</div>
            <div class="sub">Admin Portal ‚Äî Enter access code</div>
            <div class="login-error" id="loginError">Invalid access code</div>
            <input type="password" id="adminPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="30"
                onkeypress="if(event.key==='Enter')doLogin()">
            <button class="btn btn-p btn-block" onclick="doLogin()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                    <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                </svg>
                Unlock Dashboard
            </button>
        </div>
    </div>

    <button class="menu-toggle" id="menuBtn" onclick="toggleSidebar()">‚ò∞</button>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="brand"><span>MOD</span>Galaxy</div>
        <div class="nav-item active" onclick="go('dash')" id="navDash">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="9" />
                <rect x="14" y="3" width="7" height="5" />
                <rect x="14" y="12" width="7" height="9" />
                <rect x="3" y="16" width="7" height="5" />
            </svg>
            Dashboard
        </div>
        <div class="nav-item" onclick="go('apps')" id="navApps">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="5" y="2" width="14" height="20" rx="2" ry="2" />
                <line x1="12" y1="18" x2="12.01" y2="18" />
            </svg>
            App Library
        </div>
        <div class="nav-item" onclick="go('cats')" id="navCats">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 7h-4.5A2.5 2.5 0 0 1 13 4.5V3" />
                <path d="M4 7h4.5A2.5 2.5 0 0 0 11 4.5V3" />
                <path d="M4 17h4.5A2.5 2.5 0 0 1 11 19.5V21" />
                <path d="M20 17h-4.5A2.5 2.5 0 0 0 13 19.5V21" />
                <line x1="8" y1="3" x2="16" y2="3" />
                <line x1="8" y1="21" x2="16" y2="21" />
                <line x1="3" y1="12" x2="21" y2="12" />
            </svg>
            Categories
        </div>
        <div class="nav-item" onclick="go('analytics')" id="navAnalytics">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="20" x2="18" y2="10" />
                <line x1="12" y1="20" x2="12" y2="4" />
                <line x1="6" y1="20" x2="6" y2="14" />
            </svg>
            Analytics
        </div>
        <div class="nav-sep"></div>
        <div class="nav-item" onclick="window.open('index.html','_blank')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="2" />
                <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                <path d="m5 5 14 14" />
            </svg>
            View Live Site
        </div>
        <div style="flex:1"></div>
        <div class="nav-item" style="color:#ef4444" onclick="logout()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                <polyline points="16 17 21 12 16 7" />
                <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            Logout
        </div>
    </div>

    <!-- Main Content -->
    <div class="main">

        <!-- ======= DASHBOARD ======= -->
        <div id="vDash">
            <div class="page-top">
                <div>
                    <div class="page-title">Dashboard Overview</div>
                    <div class="page-subtitle">
                        <span class="sync-dot online" id="syncDot"></span>
                        <span id="syncStatus">Connected to Firebase</span>
                    </div>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                    <button class="btn btn-s" onclick="loadData()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M23 4v6h-6" />
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                        </svg>
                        Refresh
                    </button>
                    <button class="btn btn-s" onclick="document.getElementById('jsonFile').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        Import JSON
                    </button>
                    <button class="btn btn-p" onclick="downloadJSON()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        Export Backup
                    </button>
                </div>
            </div>
            <div class="stats">
                <div class="stat s1">
                    <div class="stat-lbl">Total Apps</div>
                    <div class="stat-val" id="sTotal">‚Äî</div>
                </div>
                <div class="stat s2">
                    <div class="stat-lbl">Categories</div>
                    <div class="stat-val" id="sCats">‚Äî</div>
                </div>
                <div class="stat s3">
                    <div class="stat-lbl">Avg Rating</div>
                    <div class="stat-val" id="sAvg">‚Äî</div>
                </div>
                <div class="stat s5">
                    <div class="stat-lbl">Total Visits</div>
                    <div class="stat-val" id="sTotalVisits">‚Äî</div>
                </div>
            </div>
            <div class="section-title">üìä Category Breakdown</div>
            <div id="catBreakdown"
                style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;"></div>
            <input type="file" id="jsonFile" accept=".json" class="hidden">
            <div class="toolbar"><span style="color:var(--text-light);font-size:0.8rem;" id="lastSync">‚Äî</span></div>
        </div>

        <!-- ======= APPS ======= -->
        <div id="vApps" class="hidden">
            <div class="page-top">
                <div>
                    <div class="page-title">App Library</div>
                    <div class="page-subtitle" id="appCount">0 apps</div>
                </div>
                <button class="btn btn-p" onclick="showForm()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    Add New App
                </button>
            </div>
            <div class="toolbar">
                <input type="text" id="searchInput" placeholder="Search name, ID, developer..." style="flex:1;">
                <select id="filterCat" onchange="renderTable()">
                    <option value="">All Categories</option>
                </select>
                <select id="sortBy" onchange="renderTable()">
                    <option value="name">Sort: Name</option>
                    <option value="rating">Rating (High to Low)</option>
                    <option value="appId">App ID</option>
                    <option value="dateAdded">Date Added</option>
                </select>
            </div>
            <div class="tbl-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Icon</th>
                            <th>App Name</th>
                            <th>ID</th>
                            <th>Category</th>
                            <th>Version</th>
                            <th>Rating</th>
                            <th style="text-align:right;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- ======= CATEGORIES ======= -->
        <div id="vCats" class="hidden">
            <div class="page-top">
                <div>
                    <div class="page-title">Category Manager</div>
                    <div class="page-subtitle" id="catCount">Manage your app categories</div>
                </div>
                <button class="btn btn-p" onclick="showCatForm()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    New Category
                </button>
            </div>
            <div id="catGrid" class="cat-mgr-grid"></div>
        </div>

        <!-- ======= ANALYTICS ======= -->
        <div id="vAnalytics" class="hidden">
            <div class="page-top">
                <div>
                    <div class="page-title">Analytics Dashboard</div>
                    <div class="page-subtitle">Complete insights from Firebase + App Data</div>
                </div>
                <button class="btn btn-s" onclick="loadAnalytics()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6" />
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                    </svg>
                    Refresh
                </button>
            </div>
            <div class="stats" style="grid-template-columns:repeat(3,1fr);">
                <div class="stat s5">
                    <div class="stat-lbl">Total Page Views</div>
                    <div class="stat-val" id="aTotal">‚Äî</div>
                </div>
                <div class="stat s6">
                    <div class="stat-lbl">Today's Views</div>
                    <div class="stat-val" id="aToday">‚Äî</div>
                </div>
                <div class="stat s2">
                    <div class="stat-lbl">Total App Views</div>
                    <div class="stat-val" id="aAppViews">‚Äî</div>
                </div>
            </div>
            <div class="stats" style="grid-template-columns:repeat(3,1fr);">
                <div class="stat s1">
                    <div class="stat-lbl">Total Apps</div>
                    <div class="stat-val" id="aAppsCount">‚Äî</div>
                </div>
                <div class="stat s3">
                    <div class="stat-lbl">Avg Rating</div>
                    <div class="stat-val" id="aAvgRating">‚Äî</div>
                </div>
                <div class="stat s4">
                    <div class="stat-lbl">Categories</div>
                    <div class="stat-val" id="aCatsCount">‚Äî</div>
                </div>
            </div>
            <div class="stats" style="grid-template-columns:repeat(2,1fr);">
                <div class="stat s6">
                    <div class="stat-lbl">Total Searches</div>
                    <div class="stat-val" id="aTotalSearches">‚Äî</div>
                </div>
                <div class="stat s7">
                    <div class="stat-lbl">User Ratings</div>
                    <div class="stat-val" id="aTotalRatings">‚Äî</div>
                </div>
            </div>
            <!-- Analytics Grid -->
            <div class="ana-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;">
                <div>
                    <div class="section-title">üìÖ Daily Views (Last 7 Days)</div>
                    <div id="dailyChart" class="chart-bar-wrap"
                        style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);">
                    </div>
                </div>
                <div>
                    <div class="section-title">üî• Most Viewed Apps</div>
                    <div id="topApps"
                        style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);max-height:300px;overflow-y:auto;">
                    </div>
                </div>
            </div>
            <div class="ana-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;">
                <div>
                    <div class="section-title">üì• Most Downloaded Apps</div>
                    <div id="topDownloads"
                        style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);max-height:300px;overflow-y:auto;">
                    </div>
                </div>
                <div>
                    <div class="section-title">‚≠ê Top Rated Apps</div>
                    <div id="topRated"
                        style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);max-height:300px;overflow-y:auto;">
                    </div>
                </div>
            </div>
            <div class="ana-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;">
                <div>
                    <div class="section-title">üìä Apps per Category</div>
                    <div id="catChart" class="chart-bar-wrap"
                        style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);">
                    </div>
                </div>
                <div>
                    <div class="section-title">üÜï Recently Added</div>
                    <div id="recentApps"
                        style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);max-height:300px;overflow-y:auto;">
                    </div>
                </div>
            </div>
            <div style="margin-top:20px;">
                <div class="section-title">üìà Rating Distribution</div>
                <div id="ratingChart" class="chart-bar-wrap"
                    style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);">
                </div>
            </div>
            <div class="ana-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;">
                <div>
                    <div class="section-title">üîç Top Search Keywords</div>
                    <div id="topSearches" class="chart-bar-wrap"
                        style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);max-height:350px;overflow-y:auto;">
                    </div>
                </div>
                <div>
                    <div class="section-title">üåü User Ratings</div>
                    <div id="userRatingsPanel"
                        style="background:var(--white);padding:20px;border-radius:var(--radius-lg);border:1px solid var(--border);max-height:350px;overflow-y:auto;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ======= APP FORM PANEL ======= -->
    <div class="panel" id="formPanel">
        <div class="panel-header">
            <h2 id="formTitle">Add New App</h2>
            <button class="btn btn-s btn-sm" onclick="hideForm()">‚úï Close</button>
        </div>
        <div class="panel-body">
            <div class="icon-preview" id="livePreview">
                <img id="prevIcon" src="https://via.placeholder.com/64/f0f0f0/888?text=APP">
                <div>
                    <div class="name" id="prevName">App Name</div>
                    <div class="slug" id="prevSlug">slug-id</div>
                </div>
            </div>
            <form id="appForm">
                <input type="hidden" id="fDocId">
                <div class="fg"><label>App Name <span class="req">*</span></label><input type="text" id="fName"
                        class="fc" required placeholder="My Awesome App" oninput="autoSlug();liveUpdate();"></div>
                <div class="row2">
                    <div class="fg"><label>App ID (num)</label><input type="number" id="fAppId" class="fc"
                            placeholder="Auto-generated"></div>
                    <div class="fg"><label>Slug ID <span class="req">*</span></label><input type="text" id="fSlug"
                            class="fc" required placeholder="my-awesome-app">
                        <div class="hint">Auto-generated from name</div>
                    </div>
                </div>
                <div class="row2">
                    <div class="fg"><label>Category</label><select id="fCat" class="fc"></select></div>
                    <div class="fg"><label>Version</label><input type="text" id="fVer" class="fc" placeholder="1.0.0">
                    </div>
                </div>
                <div class="row2">
                    <div class="fg"><label>Size</label><input type="text" id="fSize" class="fc" placeholder="50 MB">
                    </div>
                    <div class="fg"><label>Rating</label><input type="number" id="fRating" class="fc" step="0.1" min="0"
                            max="5" placeholder="4.5"></div>
                </div>
                <div class="fg"><label>Developer</label><input type="text" id="fDev" class="fc"
                        placeholder="Developer Name"></div>
                <div class="fg"><label>Package Name</label><input type="text" id="fPkg" class="fc"
                        placeholder="com.example.app"></div>
                <div class="fg"><label>Icon URL</label><input type="url" id="fIcon" class="fc" placeholder="https://..."
                        oninput="liveUpdate()"></div>
                <div class="fg"><label>Download URL</label><input type="url" id="fDlUrl" class="fc"
                        placeholder="https://..."></div>
                <div class="fg"><label>Downloads</label><input type="text" id="fDls" class="fc" placeholder="e.g. 10M+">
                </div>
                <div class="row2">
                    <div class="fg"><label>Required App</label><select id="fReqTo" class="fc"></select></div>
                    <div class="fg" style="display:flex;align-items:center;padding-top:24px;">
                        <input type="checkbox" id="fShowReqTo"
                            style="width:18px;height:18px;cursor:pointer;margin-right:8px;">
                        <label for="fShowReqTo" style="margin:0;cursor:pointer;">Show on Page</label>
                    </div>
                </div>
                <div class="fg"><label>Description</label><textarea id="fDesc" class="fc" rows="3"
                        placeholder="Short description..."></textarea></div>
                <div class="fg"><label>Screenshots (comma URLs)</label><textarea id="fShots" class="fc" rows="2"
                        placeholder="https://img1.jpg, https://img2.jpg"></textarea></div>
                <div class="fg" style="display:flex;align-items:center;gap:10px;">
                    <input type="checkbox" id="fShowShots" style="width:18px;height:18px;">
                    <label for="fShowShots" style="margin:0;font-weight:600;cursor:pointer;">Show Screenshots
                        Section</label>
                </div>
                <div class="nav-sep" style="background:var(--border);margin:20px 0 16px;"></div>
                <div class="section-title" style="margin-bottom:12px;">üîç SEO Settings</div>
                <div class="fg"><label>SEO Keywords</label><input type="text" id="fSeoKeywords" class="fc"
                        placeholder="keyword1, keyword2, keyword3...">
                    <div class="hint">Comma-separated keywords</div>
                </div>
                <div class="fg"><label>SEO Description</label><textarea id="fSeoDesc" class="fc" rows="2"
                        placeholder="Custom meta description..."></textarea>
                </div>
            </form>
        </div>
        <div class="panel-footer">
            <button class="btn btn-p" style="flex:1" id="saveBtn" onclick="saveApp()">üíæ Save to Firebase</button>
            <button class="btn btn-s" onclick="hideForm()">Cancel</button>
        </div>
    </div>

    <!-- ======= CATEGORY FORM PANEL ======= -->
    <div class="panel" id="catPanel">
        <div class="panel-header">
            <h2 id="catFormTitle">New Category</h2>
            <button class="btn btn-s btn-sm" onclick="hideCatForm()">‚úï Close</button>
        </div>
        <div class="panel-body">
            <form id="catForm">
                <input type="hidden" id="cDocId">
                <div class="fg"><label>Category Name <span class="req">*</span></label><input type="text" id="cName"
                        class="fc" required placeholder="e.g. Racing"></div>
                <div class="fg"><label>Icon Emoji</label><input type="text" id="cEmoji" class="fc" placeholder="üèéÔ∏è"
                        maxlength="4">
                    <div class="hint">Use one emoji as icon</div>
                </div>
                <div class="fg"><label>Description</label><textarea id="cDesc" class="fc" rows="2"
                        placeholder="Short category description..."></textarea></div>
                <div class="fg"><label>Color (hex)</label><input type="color" id="cColor" class="fc" value="#00c853"
                        style="padding:4px;height:44px;"></div>
            </form>
        </div>
        <div class="panel-footer">
            <button class="btn btn-p" style="flex:1" onclick="saveCat()">üíæ Save Category</button>
            <button class="btn btn-s" onclick="hideCatForm()">Cancel</button>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>

    <script>
        let D = [];
        let CATS = [];
        const PW = 'Ishant@15';

        // ======= INIT =======
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('mgAdmin') === 'true') {
                document.getElementById('loginOverlay').classList.add('hidden');
                loadData();
            }
            document.getElementById('searchInput').addEventListener('input', renderTable);
            document.getElementById('jsonFile').addEventListener('change', importJSON);
        });

        // ======= AUTH =======
        function doLogin() {
            const p = document.getElementById('adminPass').value;
            if (p === PW) {
                localStorage.setItem('mgAdmin', 'true');
                document.getElementById('loginOverlay').style.opacity = '0';
                document.getElementById('loginOverlay').style.transition = 'opacity 0.3s';
                setTimeout(() => document.getElementById('loginOverlay').classList.add('hidden'), 300);
                loadData();
                toast('‚úÖ Welcome to ModGalaxy Admin!', 'success');
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPass').style.borderColor = 'var(--danger)';
                setTimeout(() => { document.getElementById('loginError').style.display = 'none'; document.getElementById('adminPass').style.borderColor = ''; }, 2000);
            }
        }
        function logout() { localStorage.removeItem('mgAdmin'); location.reload(); }

        // ======= NAV =======
        function go(t) {
            ['Dash', 'Apps', 'Cats', 'Analytics'].forEach(v => {
                const id = 'nav' + v;
                const el = document.getElementById(id);
                if (el) el.classList.toggle('active', v.toLowerCase() === t);
                const view = document.getElementById('v' + v);
                if (view) view.classList.toggle('hidden', v.toLowerCase() !== t);
            });
            if (t === 'analytics') loadAnalytics();
            if (t === 'cats') renderCats();
            if (window.innerWidth <= 768) toggleSidebar();
        }
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('show');
        }

        // ======= FIRESTORE DATA =======
        async function loadData() {
            try {
                document.getElementById('syncDot').className = 'sync-dot online';
                document.getElementById('syncStatus').textContent = 'Loading from Firebase...';
                D = await getAllApps();
                CATS = await getAllCategories();
                refreshAll();
                document.getElementById('syncStatus').textContent = 'Connected to Firebase';
                toast('üî• Loaded ' + D.length + ' apps from Firestore', 'success');
                // Quick visits stat
                try {
                    const ana = await getAnalytics();
                    document.getElementById('sTotalVisits').textContent = (ana.visits.total || 0).toLocaleString();
                } catch (e) { }
            } catch (e) {
                console.error('Firestore error:', e);
                document.getElementById('syncDot').className = 'sync-dot offline';
                document.getElementById('syncStatus').textContent = 'Connection error';
                toast('‚ùå Firebase error: ' + e.message, 'error');
            }
        }

        // ======= IMPORT JSON =======
        function importJSON(e) {
            const f = e.target.files[0]; if (!f) return;
            const r = new FileReader();
            r.onload = async (ev) => {
                try {
                    const apps = JSON.parse(ev.target.result);
                    if (!Array.isArray(apps)) throw new Error('JSON must be an array');
                    if (!confirm(`Import ${apps.length} apps to Firestore?`)) return;
                    toast('‚è≥ Uploading ' + apps.length + ' apps...', 'success');
                    let count = 0;
                    for (let i = 0; i < apps.length; i += 20) {
                        const batch = db.batch();
                        apps.slice(i, i + 20).forEach(app => {
                            const docId = app.id || ('app-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5));
                            batch.set(db.collection('apps').doc(docId), app, { merge: true });
                            count++;
                        });
                        await batch.commit();
                    }
                    toast('‚úÖ Imported ' + count + ' apps!', 'success');
                    loadData();
                } catch (x) { toast('‚ùå ' + x.message, 'error'); }
            };
            r.readAsText(f); e.target.value = '';
        }

        // ======= REFRESH UI =======
        function refreshAll() {
            document.getElementById('sTotal').textContent = D.length;
            const cats = [...new Set(D.map(a => a.category).filter(Boolean))];
            document.getElementById('sCats').textContent = cats.length;
            const avg = D.length ? (D.reduce((s, a) => s + (parseFloat(a.rating) || 0), 0) / D.length).toFixed(1) : '0';
            document.getElementById('sAvg').textContent = avg;
            document.getElementById('lastSync').textContent = 'Last sync: ' + new Date().toLocaleTimeString();

            // Category Breakdown
            const cc = {}; D.forEach(a => { if (a.category) cc[a.category] = (cc[a.category] || 0) + 1; });
            document.getElementById('catBreakdown').innerHTML = Object.entries(cc).sort((a, b) => b[1] - a[1]).map(([c, n]) => `
                <div style="background:var(--white);padding:14px 16px;border-radius:var(--radius-lg);border:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow-sm);">
                    <span style="font-weight:600;color:var(--text);font-size:0.85rem;">${c}</span>
                    <span style="background:var(--primary-light);color:var(--primary-dark);padding:4px 12px;border-radius:30px;font-size:0.75rem;font-weight:600;">${n}</span>
                </div>
            `).join('');

            // Populate category filter + form dropdown
            const filterEl = document.getElementById('filterCat');
            filterEl.innerHTML = '<option value="">All Categories</option>' + cats.sort().map(c => `<option>${c}</option>`).join('');
            populateCatDropdown();
            renderTable();
        }

        function populateCatDropdown() {
            const sel = document.getElementById('fCat');
            const defaultCats = ['Action', 'Adventure', 'Arcade', 'Racing', 'Simulation', 'Sports', 'Strategy', 'Tools', 'Social', 'Productivity', 'Entertainment', 'Communication', 'Photography'];
            const firestoreCats = CATS.map(c => c.name);
            const allCatNames = [...new Set([...defaultCats, ...firestoreCats])].sort();
            sel.innerHTML = allCatNames.map(c => `<option>${c}</option>`).join('');
        }

        // ======= TABLE =======
        function renderTable() {
            const q = (document.getElementById('searchInput').value || '').toLowerCase();
            const fc = document.getElementById('filterCat').value;
            const sort = document.getElementById('sortBy').value;
            let f = D.filter(a => {
                const mt = (a.name || '').toLowerCase().includes(q) || String(a.appId || '').includes(q) || (a.developer || '').toLowerCase().includes(q) || (a.id || '').toLowerCase().includes(q);
                return mt && (!fc || a.category === fc);
            });
            f.sort((a, b) => {
                if (sort === 'rating') return (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0);
                if (sort === 'appId') return (a.appId || 0) - (b.appId || 0);
                if (sort === 'dateAdded') return (b.dateAdded || '').localeCompare(a.dateAdded || '');
                return (a.name || '').localeCompare(b.name || '');
            });
            document.getElementById('appCount').textContent = f.length + ' of ' + D.length + ' apps';
            document.getElementById('tbody').innerHTML = f.map(a => {
                const did = a._docId || a.id;
                return `<tr>
                    <td><img src="${a.icon || ''}" class="ico" onerror="this.src='https://via.placeholder.com/40/f0f0f0/888?text=?'"></td>
                    <td><div style="font-weight:600;color:var(--text);font-size:0.85rem;">${a.name || ''}</div><div style="color:var(--text-light);font-size:0.72rem;">${a.package || a.id || ''}</div></td>
                    <td><span class="badge badge-id">${a.appId || '‚Äî'}</span></td>
                    <td><span class="badge badge-c">${a.category || ''}</span></td>
                    <td style="font-size:0.82rem;">${a.version || '‚Äî'}</td>
                    <td><span style="color:#f59e0b;font-weight:600;font-size:0.85rem;">‚òÖ ${a.rating || '‚Äî'}</span></td>
                    <td style="text-align:right;white-space:nowrap;">
                        <button class="btn btn-s btn-sm" onclick="dupApp('${did}')">üìë Duplicate</button>
                        <button class="btn btn-s btn-sm" onclick="editApp('${did}')">‚úèÔ∏è Edit</button>
                        <button class="btn btn-d btn-sm" onclick="delApp('${did}','${(a.name || '').replace(/'/g, "\\'")}')">üóëÔ∏è Delete</button>
                    </td>
                </tr>`;
            }).join('');
        }

        // ======= APP FORM =======
        function populateReqApps() {
            const sel = document.getElementById('fReqTo');
            sel.innerHTML = '<option value="">-- None --</option>';
            // Store current apps in a temp array to sort
            const sorted = [...D].sort((a, b) => a.name.localeCompare(b.name));
            sorted.forEach(a => {
                const opt = document.createElement('option');
                opt.value = a.id; // Use slug as value
                opt.textContent = a.name;
                sel.appendChild(opt);
            });
        }

        function showForm() {
            document.getElementById('appForm').reset();
            populateReqApps(); // Refresh list
            document.getElementById('fShowShots').checked = true;
            document.getElementById('fShowReqTo').checked = true;
            document.getElementById('fDocId').value = '';
            document.getElementById('formTitle').textContent = 'Add New App';
            const next = D.length ? Math.max(...D.map(a => a.appId || 0)) + 1 : 1001;
            document.getElementById('fAppId').value = next;
            document.getElementById('prevIcon').src = 'https://via.placeholder.com/64/f0f0f0/888?text=NEW';
            document.getElementById('prevName').textContent = 'New App';
            document.getElementById('prevSlug').textContent = '‚Äî';
            document.getElementById('fSeoKeywords').value = '';
            document.getElementById('fSeoDesc').value = '';
            document.getElementById('formPanel').classList.add('open');
        }
        function hideForm() { document.getElementById('formPanel').classList.remove('open'); }

        function editApp(docId) {
            const a = D.find(x => (x._docId || x.id) === docId);
            if (!a) return;
            populateReqApps(); // Refresh list
            document.getElementById('fDocId').value = docId;
            document.getElementById('fName').value = a.name || '';
            document.getElementById('fAppId').value = a.appId || '';
            document.getElementById('fSlug').value = a.id || '';
            document.getElementById('fCat').value = a.category || 'Action';
            document.getElementById('fVer').value = a.version || '';
            document.getElementById('fSize').value = a.size || '';
            document.getElementById('fRating').value = a.rating || '';
            document.getElementById('fDev').value = a.developer || '';
            document.getElementById('fPkg').value = a.package || '';
            document.getElementById('fIcon').value = a.icon || '';
            document.getElementById('fDlUrl').value = a.downloadUrl || '';
            document.getElementById('fDls').value = a.downloads || '';
            document.getElementById('fReqTo').value = a.requiredTo || '';
            document.getElementById('fShowReqTo').checked = (a.showRequiredTo !== false);
            document.getElementById('fDesc').value = a.description || '';
            document.getElementById('fShots').value = a.screenshots ? a.screenshots.join(', ') : '';
            document.getElementById('fShowShots').checked = (a.showScreenshots !== false);
            document.getElementById('fSeoKeywords').value = a.seoKeywords || '';
            document.getElementById('fSeoDesc').value = a.seoDescription || '';
            document.getElementById('formTitle').textContent = 'Edit: ' + a.name;
            liveUpdate();
            document.getElementById('formPanel').classList.add('open');
        }

        async function saveApp() {
            const name = document.getElementById('fName').value.trim();
            const slug = document.getElementById('fSlug').value.trim();
            if (!name) { toast('‚ùå App name required', 'error'); return; }
            if (!slug) { toast('‚ùå Slug ID required', 'error'); return; }
            const btn = document.getElementById('saveBtn');
            btn.disabled = true; btn.innerHTML = '<span class="loading"></span> Saving...';
            const existingDocId = document.getElementById('fDocId').value;
            const shots = document.getElementById('fShots').value;
            const app = {
                id: slug,
                appId: parseInt(document.getElementById('fAppId').value) || null,
                name, category: document.getElementById('fCat').value,
                version: document.getElementById('fVer').value,
                size: document.getElementById('fSize').value,
                rating: document.getElementById('fRating').value,
                developer: document.getElementById('fDev').value,
                package: document.getElementById('fPkg').value,
                icon: document.getElementById('fIcon').value,
                downloadUrl: document.getElementById('fDlUrl').value,
                downloads: document.getElementById('fDls').value,
                requiredTo: document.getElementById('fReqTo').value,
                showRequiredTo: document.getElementById('fShowReqTo').checked,
                description: document.getElementById('fDesc').value,
                screenshots: shots ? shots.split(',').map(s => s.trim()).filter(Boolean) : [],
                showScreenshots: document.getElementById('fShowShots').checked,
                seoKeywords: document.getElementById('fSeoKeywords').value,
                seoDescription: document.getElementById('fSeoDesc').value,
                updatedAt: new Date().toISOString()
            };
            if (!existingDocId) app.dateAdded = new Date().toISOString().split('T')[0];
            try {
                if (existingDocId) { await db.collection('apps').doc(existingDocId).update(app); toast('‚úÖ Updated: ' + app.name, 'success'); }
                else { await db.collection('apps').doc(slug).set(app); toast('‚úÖ Added: ' + app.name, 'success'); }
                hideForm(); loadData();
            } catch (e) { toast('‚ùå Save failed: ' + e.message, 'error'); }
            btn.disabled = false; btn.innerHTML = 'üíæ Save to Firebase';
        }

        async function delApp(docId, name) {
            if (!confirm('Delete "' + name + '"?')) return;
            try { await db.collection('apps').doc(docId).delete(); toast('üóëÔ∏è Deleted: ' + name, 'success'); loadData(); }
            catch (e) { toast('‚ùå ' + e.message, 'error'); }
        }

        async function dupApp(docId) {
            const a = D.find(x => (x._docId || x.id) === docId); if (!a) return;
            const copy = { ...a }; delete copy._docId;
            copy.id = copy.id + '-copy'; copy.name = copy.name + ' (Copy)';
            copy.appId = D.length ? Math.max(...D.map(x => x.appId || 0)) + 1 : 1001;
            copy.dateAdded = new Date().toISOString().split('T')[0];
            try { await db.collection('apps').doc(copy.id).set(copy); toast('üìë Duplicated', 'success'); loadData(); }
            catch (e) { toast('‚ùå ' + e.message, 'error'); }
        }

        // ======= CATEGORY MANAGER =======
        function renderCats() {
            const appCounts = {};
            D.forEach(a => { if (a.category) appCounts[a.category] = (appCounts[a.category] || 0) + 1; });

            const defaultCats = ['Action', 'Adventure', 'Arcade', 'Racing', 'Simulation', 'Sports', 'Strategy', 'Tools', 'Social', 'Productivity', 'Entertainment', 'Communication', 'Photography'];
            const allNames = [...new Set([...CATS.map(c => c.name), ...defaultCats, ...Object.keys(appCounts)])].sort();

            const grid = document.getElementById('catGrid');
            grid.innerHTML = allNames.map(name => {
                const fc = CATS.find(c => c.name === name);
                const emoji = fc ? fc.emoji : 'üì¶';
                const desc = fc ? fc.description : '';
                const color = fc ? fc.color : '#00c853';
                const count = appCounts[name] || 0;
                const docId = fc ? fc._docId : '';
                return `<div class="cat-mgr-card" style="border-top:3px solid ${color};">
                    <div class="top"><span class="emoji">${emoji}</span><span class="cname">${name}</span></div>
                    ${desc ? `<div class="cdesc">${desc}</div>` : ''}
                    <div class="ccount">${count} app${count !== 1 ? 's' : ''}</div>
                    <div class="actions">
                        <button class="btn btn-s btn-sm" onclick="editCat('${name}')">‚úèÔ∏è Edit</button>
                        ${count === 0 && docId ? `<button class="btn btn-d btn-sm" onclick="delCat('${docId}','${name}')">üóëÔ∏è Delete</button>` : ''}
                    </div>
                </div>`;
            }).join('');
            document.getElementById('catCount').textContent = allNames.length + ' categories';
        }

        function showCatForm() {
            document.getElementById('catForm').reset();
            document.getElementById('cDocId').value = '';
            document.getElementById('catFormTitle').textContent = 'New Category';
            document.getElementById('cColor').value = '#00c853';
            document.getElementById('catPanel').classList.add('open');
        }
        function hideCatForm() { document.getElementById('catPanel').classList.remove('open'); }

        function editCat(name) {
            const fc = CATS.find(c => c.name === name);
            document.getElementById('cDocId').value = fc ? fc._docId : '';
            document.getElementById('cName').value = name;
            document.getElementById('cEmoji').value = fc ? fc.emoji : 'üì¶';
            document.getElementById('cDesc').value = fc ? fc.description : '';
            document.getElementById('cColor').value = fc ? fc.color : '#00c853';
            document.getElementById('catFormTitle').textContent = 'Edit: ' + name;
            document.getElementById('catPanel').classList.add('open');
        }

        async function saveCat() {
            const name = document.getElementById('cName').value.trim();
            if (!name) { toast('‚ùå Name required', 'error'); return; }
            const data = { name, emoji: document.getElementById('cEmoji').value || 'üì¶', description: document.getElementById('cDesc').value, color: document.getElementById('cColor').value, updatedAt: new Date().toISOString() };
            const existingId = document.getElementById('cDocId').value;
            try {
                if (existingId) { await db.collection('categories').doc(existingId).update(data); }
                else { const slug = name.toLowerCase().replace(/[^a-z0-9]+/g, '-'); await db.collection('categories').doc(slug).set(data); }
                toast('‚úÖ Category saved: ' + name, 'success');
                hideCatForm(); CATS = await getAllCategories(); renderCats(); populateCatDropdown();
            } catch (e) { toast('‚ùå ' + e.message, 'error'); }
        }

        async function delCat(docId, name) {
            if (!confirm('Delete category "' + name + '"?')) return;
            try { await db.collection('categories').doc(docId).delete(); toast('üóëÔ∏è Deleted: ' + name, 'success'); CATS = await getAllCategories(); renderCats(); populateCatDropdown(); }
            catch (e) { toast('‚ùå ' + e.message, 'error'); }
        }

        // ======= ANALYTICS =======
        function localToday() { const d = new Date(); return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0'); }
        function parseDownloads(s) { if (!s) return 0; s = String(s).toLowerCase().replace(/[,+]/g, ''); if (s.endsWith('m')) return parseFloat(s) * 1000000; if (s.endsWith('k')) return parseFloat(s) * 1000; if (s.endsWith('b')) return parseFloat(s) * 1000000000; return parseInt(s) || 0; }
        function fmtNum(n) { if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B'; if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M'; if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K'; return n.toString(); }
        function appRow(app, rightText, rightColor) {
            const icon = app.icon ? `<img src="${app.icon}" onerror="this.style.display='none'" style="width:36px;height:36px;border-radius:8px;object-fit:cover;">` : '';
            return `<div class="top-app-row">${icon}<span class="aname">${app.name || 'Unknown'}</span><span class="acount" style="color:${rightColor || 'var(--primary)'};">${rightText}</span></div>`;
        }

        async function loadAnalytics() {
            try {
                const ana = await getAnalytics();
                const today = localToday();

                // Firebase stats
                document.getElementById('aTotal').textContent = (ana.visits.total || 0).toLocaleString();
                const todayVal = (ana.visits.daily && ana.visits.daily[today]) || 0;
                document.getElementById('aToday').textContent = todayVal.toLocaleString();
                document.getElementById('aAppViews').textContent = (ana.appViews.totalViews || 0).toLocaleString();
                document.getElementById('sTotalVisits').textContent = (ana.visits.total || 0).toLocaleString();

                // App data stats
                document.getElementById('aAppsCount').textContent = D.length;
                const cats = [...new Set(D.map(a => a.category).filter(Boolean))];
                document.getElementById('aCatsCount').textContent = cats.length;
                const avg = D.length ? (D.reduce((s, a) => s + (parseFloat(a.rating) || 0), 0) / D.length).toFixed(1) : '0';
                document.getElementById('aAvgRating').textContent = avg;

                // Daily chart (last 7 days)
                const daily = ana.visits.daily || {};
                const days = [];
                for (let i = 6; i >= 0; i--) { const d = new Date(); d.setDate(d.getDate() - i); const key = d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0'); days.push({ label: d.toLocaleDateString('en', { weekday: 'short', month: 'short', day: 'numeric' }), count: daily[key] || 0 }); }
                const maxD = Math.max(...days.map(d => d.count), 1);
                document.getElementById('dailyChart').innerHTML = days.map(d => `<div class="chart-row"><span class="chart-label" style="width:100px;">${d.label}</span><div class="chart-bar" style="width:${Math.max((d.count / maxD) * 100, 4)}%;flex:0 0 auto;"></div><span class="chart-val">${d.count}</span></div>`).join('');

                // Most Viewed Apps
                const appViews = ana.appViews.apps || {};
                const viewed = Object.entries(appViews).sort((a, b) => b[1] - a[1]).slice(0, 10);
                document.getElementById('topApps').innerHTML = viewed.length === 0 ? '<p style="color:var(--text-light);text-align:center;padding:20px;">No app views tracked yet</p>' : viewed.map(([slug, count]) => { const app = D.find(a => a.id === slug || a._docId === slug); return app ? appRow(app, count + ' views', 'var(--primary)') : `<div class="top-app-row"><span class="aname">${slug}</span><span class="acount">${count} views</span></div>`; }).join('');

                // Most Downloaded Apps
                const byDl = [...D].filter(a => a.downloads).sort((a, b) => parseDownloads(b.downloads) - parseDownloads(a.downloads)).slice(0, 10);
                document.getElementById('topDownloads').innerHTML = byDl.length === 0 ? '<p style="color:var(--text-light);text-align:center;padding:20px;">No download data</p>' : byDl.map(a => appRow(a, a.downloads || '0', '#3b82f6')).join('');

                // Top Rated Apps
                const byRating = [...D].filter(a => parseFloat(a.rating) > 0).sort((a, b) => (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0)).slice(0, 10);
                document.getElementById('topRated').innerHTML = byRating.length === 0 ? '<p style="color:var(--text-light);text-align:center;padding:20px;">No rated apps</p>' : byRating.map(a => appRow(a, '‚òÖ ' + (a.rating || '0'), '#f59e0b')).join('');

                // Category distribution chart
                const catCount = {}; D.forEach(a => { if (a.category) catCount[a.category] = (catCount[a.category] || 0) + 1; });
                const catSorted = Object.entries(catCount).sort((a, b) => b[1] - a[1]);
                const maxC = catSorted.length ? catSorted[0][1] : 1;
                const catColors = ['#00c853', '#3b82f6', '#f59e0b', '#8b5cf6', '#ec4899', '#14b8a6', '#ef4444', '#6366f1', '#f97316', '#06b6d4'];
                document.getElementById('catChart').innerHTML = catSorted.map(([c, n], i) => `<div class="chart-row"><span class="chart-label" style="width:100px;">${c}</span><div class="chart-bar" style="width:${Math.max((n / maxC) * 100, 4)}%;background:${catColors[i % catColors.length]};"></div><span class="chart-val">${n}</span></div>`).join('') || '<p style="color:var(--text-light);text-align:center;">No data</p>';

                // Recently Added
                const recent = [...D].filter(a => a.dateAdded).sort((a, b) => (b.dateAdded || '').localeCompare(a.dateAdded || '')).slice(0, 8);
                document.getElementById('recentApps').innerHTML = recent.length === 0 ? '<p style="color:var(--text-light);text-align:center;padding:20px;">No date info</p>' : recent.map(a => appRow(a, a.dateAdded || '‚Äî', '#888')).join('');

                // Rating Distribution
                const rBuckets = { '5‚òÖ': 0, '4‚òÖ': 0, '3‚òÖ': 0, '2‚òÖ': 0, '1‚òÖ': 0, 'Unrated': 0 };
                D.forEach(a => { const r = parseFloat(a.rating); if (!r || r <= 0) rBuckets['Unrated']++; else if (r >= 4.5) rBuckets['5‚òÖ']++; else if (r >= 3.5) rBuckets['4‚òÖ']++; else if (r >= 2.5) rBuckets['3‚òÖ']++; else if (r >= 1.5) rBuckets['2‚òÖ']++; else rBuckets['1‚òÖ']++; });
                const maxR = Math.max(...Object.values(rBuckets), 1);
                const rColors = { '5‚òÖ': '#00c853', '4‚òÖ': '#66bb6a', '3‚òÖ': '#f59e0b', '2‚òÖ': '#f97316', '1‚òÖ': '#ef4444', 'Unrated': '#94a3b8' };
                document.getElementById('ratingChart').innerHTML = Object.entries(rBuckets).map(([lbl, n]) => `<div class="chart-row"><span class="chart-label" style="width:70px;">${lbl}</span><div class="chart-bar" style="width:${Math.max((n / maxR) * 100, 4)}%;background:${rColors[lbl] || 'var(--primary)'}"></div><span class="chart-val">${n}</span></div>`).join('');

                // Search Keywords
                const keywords = ana.searches.keywords || {};
                const kwSorted = Object.entries(keywords).sort((a, b) => b[1] - a[1]);
                document.getElementById('aTotalSearches').textContent = (ana.searches.total || 0).toLocaleString();
                const maxKw = kwSorted.length ? kwSorted[0][1] : 1;
                document.getElementById('topSearches').innerHTML = kwSorted.length === 0 ? '<p style="color:var(--text-light);text-align:center;padding:20px;">No searches tracked</p>' : kwSorted.slice(0, 15).map(([kw, cnt]) => `<div class="chart-row"><span class="chart-label" style="width:100px;">${kw}</span><div class="chart-bar" style="width:${Math.max((cnt / maxKw) * 100, 4)}%;background:linear-gradient(90deg,#3b82f6,#60a5fa);"></div><span class="chart-val">${cnt}</span></div>`).join('');

                // User Ratings
                try {
                    const ratingsSnap = await db.collection('ratings').orderBy('timestamp', 'desc').limit(50).get();
                    const ratings = [];
                    ratingsSnap.forEach(d => ratings.push(d.data()));
                    document.getElementById('aTotalRatings').textContent = ratings.length + (ratings.length >= 50 ? '+' : '');
                    if (ratings.length === 0) {
                        document.getElementById('userRatingsPanel').innerHTML = '<p style="color:var(--text-light);text-align:center;padding:20px;">No user ratings yet</p>';
                    } else {
                        const byApp = {};
                        ratings.forEach(r => {
                            if (!byApp[r.appSlug]) byApp[r.appSlug] = { total: 0, count: 0 };
                            byApp[r.appSlug].total += r.stars; byApp[r.appSlug].count++;
                        });
                        const appRatings = Object.entries(byApp).map(([slug, d]) => ({ slug, avg: (d.total / d.count).toFixed(1), count: d.count })).sort((a, b) => b.count - a.count);
                        document.getElementById('userRatingsPanel').innerHTML = appRatings.map(r => {
                            const app = D.find(a => a.id === r.slug || a._docId === r.slug);
                            const name = app ? app.name : r.slug;
                            const icon = app && app.icon ? `<img src="${app.icon}" style="width:28px;height:28px;border-radius:6px;object-fit:cover;" onerror="this.style.display='none'">` : '';
                            const stars = '‚òÖ'.repeat(Math.round(parseFloat(r.avg)));
                            return `<div class="top-app-row">${icon}<span class="aname">${name}</span><span style="color:#f59e0b;font-weight:600;font-size:0.85rem;">${stars} ${r.avg} (${r.count})</span></div>`;
                        }).join('');
                    }
                } catch (re) { document.getElementById('userRatingsPanel').innerHTML = '<p style="color:var(--text-light);">Could not load ratings</p>'; }

            } catch (e) {
                console.error('Analytics error:', e);
                toast('‚ùå Analytics error: ' + e.message, 'error');
            }
        }

        // ======= HELPERS =======
        function autoSlug() {
            const n = document.getElementById('fName').value;
            document.getElementById('fSlug').value = n.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
        }
        function liveUpdate() {
            document.getElementById('prevName').textContent = document.getElementById('fName').value || 'App Name';
            document.getElementById('prevSlug').textContent = document.getElementById('fSlug').value || '‚Äî';
            const ic = document.getElementById('fIcon').value;
            document.getElementById('prevIcon').src = ic || 'https://via.placeholder.com/64/f0f0f0/888?text=APP';
        }
        function downloadJSON() {
            const clean = D.map(a => { const c = { ...a }; delete c._docId; return c; });
            const a = document.createElement('a');
            a.href = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(clean, null, 2));
            a.download = 'apps-backup-' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a); a.click(); a.remove();
            toast('üíæ Backup exported', 'success');
        }
        function toast(m, type) {
            const t = document.getElementById('toast');
            t.textContent = m; t.className = 'toast ' + (type || 'success') + ' show';
            setTimeout(() => t.classList.remove('show'), 3500);
        }
    </script>
</body>

</html>